---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import ThreeScene from "../components/ThreeScene.astro";
import SlamSection from "../components/SlamSection.astro";
import Experience from "../components/Experience.astro";
import ImpactCharts from "../components/ImpactCharts.astro";
import Resume from "../components/Resume.astro";
import Portfolio from "../components/Portfolio.astro";
import StyleGuide from "../components/StyleGuide.astro";
import Colophon from "../components/Colophon.astro";
---

<Layout title="Tony Rosen | Marketing & Creative Project Manager">
	<ThreeScene />
	<div id="home-view" class="block">
		<Hero />
		<main
			class="content-layer relative z-10 bg-white shadow-2xl dark:bg-slate-900"
		>
			<SlamSection />
			<ImpactCharts />
			<Experience />
		</main>
	</div>

	<Resume />
	<Portfolio />
	<StyleGuide />
	<Colophon />
</Layout>

<style>
	.content-layer {
		position: relative;
		z-index: 10;
		margin-top: 100vh; /* Push content down to reveal fixed hero */
	}
</style>

<script>
	// View Switching Logic

	// Track virtual pageviews in Google Analytics
	function trackPageView(viewId: string) {
		// Map view IDs to readable page titles and paths
		const viewMeta: Record<string, { title: string; path: string }> = {
			home: { title: "Home", path: "/" },
			resume: { title: "Resume", path: "/resume" },
			portfolio: { title: "Portfolio", path: "/portfolio" },
			styleguide: { title: "Style Guide", path: "/styleguide" },
			colophon: { title: "Colophon", path: "/colophon" },
		};

		const meta = viewMeta[viewId] || { title: viewId, path: `/${viewId}` };

		// Send to Google Analytics (gtag.js)
		// eslint-disable-next-line @typescript-eslint/no-explicit-any
		if (typeof window !== "undefined" && (window as any).gtag) {
			// eslint-disable-next-line @typescript-eslint/no-explicit-any
			(window as any).gtag("config", "G-7LRLJTJG4L", {
				page_path: meta.path,
				page_title: `${meta.title} | Tony Rosen`,
			});
			console.log(`ðŸ“Š GA: Tracked pageview for ${meta.path}`);
		}

		// Send to PostHog
		// eslint-disable-next-line @typescript-eslint/no-explicit-any
		if (typeof window !== "undefined" && (window as any).posthog) {
			// eslint-disable-next-line @typescript-eslint/no-explicit-any
			(window as any).posthog.capture("$pageview", {
				$current_url: window.location.origin + meta.path,
				$pathname: meta.path,
				title: `${meta.title} | Tony Rosen`,
			});
			console.log(`ðŸ“Š PostHog: Tracked pageview for ${meta.path}`);
		}
	}

	function navigateTo(viewId: string) {
		const homeView = document.getElementById("home-view");
		const resumeView = document.getElementById("resume-view");
		const portfolioView = document.getElementById("portfolio-view");
		const styleGuideView = document.getElementById("styleguide-view");
		const colophonView = document.getElementById("colophon-view");

		const views = [
			homeView,
			resumeView,
			portfolioView,
			styleGuideView,
			colophonView,
		];

		// Update URL without reloading
		if (viewId === "home") {
			history.pushState(null, "", window.location.pathname); // Clear hash for home
		} else {
			history.pushState(null, "", `#${viewId}`);
		}

		// Hide all views first
		views.forEach((view) => {
			if (view) {
				view.classList.remove("block");
				view.classList.add("hidden");
			}
		});

		// Helper to reset scroll position (both native and Lenis)
		function resetScroll() {
			window.scrollTo(0, 0);
			// Also reset Lenis if it's initialized
			if (window.lenis) {
				window.lenis.scrollTo(0, { immediate: true });
			}
		}

		// Show the target view
		if (viewId === "resume" && resumeView) {
			resumeView.classList.remove("hidden");
			resumeView.classList.add("block");
			resetScroll();
			trackPageView("resume");
		} else if (viewId === "portfolio" && portfolioView) {
			portfolioView.classList.remove("hidden");
			portfolioView.classList.add("block");
			resetScroll();
			trackPageView("portfolio");
		} else if (viewId === "styleguide" && styleGuideView) {
			styleGuideView.classList.remove("hidden");
			styleGuideView.classList.add("block");
			resetScroll();
			trackPageView("styleguide");
		} else if (viewId === "colophon" && colophonView) {
			colophonView.classList.remove("hidden");
			colophonView.classList.add("block");
			resetScroll();
			trackPageView("colophon");
		} else if (homeView) {
			// Default to home
			homeView.classList.remove("hidden");
			homeView.classList.add("block");
			resetScroll();
			trackPageView("home");
		}
	}

	// Wait for DOM to be ready
	function initViewSwitching() {
		// Listen for custom event from Navbar
		window.addEventListener("view-change", (e: Event) => {
			const customEvent = e as CustomEvent;
			navigateTo(customEvent.detail);
		});

		// Check initial hash
		const hash = window.location.hash.replace("#", "");
		if (["resume", "portfolio", "styleguide", "colophon"].includes(hash)) {
			navigateTo(hash);
		} else {
			navigateTo("home");
		}
	}

	// Initialize when DOM is ready
	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", initViewSwitching);
	} else {
		initViewSwitching();
	}
</script>
